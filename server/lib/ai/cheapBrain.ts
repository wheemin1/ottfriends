/**
 * v4.0.4: Cheap Brain (Stupid Brain) - 0ì› ë°©í™”ë²½
 * ëª©ì : ë‹¨ìˆœ ì¡ë‹´/ê°ì • í‘œí˜„ì„ $0 ë¹„ìš©ìœ¼ë¡œ ì²˜ë¦¬
 * ì—”ì§„: JavaScript ì •ê·œì‹ ë§¤ì¹­ (No API)
 * ë¹„ìš©: $0
 * 
 * ì‘ë™ ì›ë¦¬:
 * 1. ì‚¬ìš©ì ì…ë ¥ì„ ì •ê·œì‹ìœ¼ë¡œ íŒ¨í„´ ë§¤ì¹­
 * 2. ë§¤ì¹­ ì„±ê³µ ì‹œ ì¦‰ì‹œ return â†’ Smart Brain í˜¸ì¶œ ì°¨ë‹¨
 * 3. ë§¤ì¹­ ì‹¤íŒ¨ ì‹œ null return â†’ Smart Brainìœ¼ë¡œ ë¼ìš°íŒ…
 */

interface CheapResponse {
  type: 'reply';
  text: string;
  keywords: [];
}

/**
 * v4.0.4.2: ì¡ë‹´ íŒ¨í„´ ë§¤ì¹­ (ì´ˆê°•ë ¥ ê´€ëŒ€ ëª¨ë“œ)
 * ë³€ê²½ì‚¬í•­: ã…‹/ã…ë§Œ 2ê°œ ì´ìƒì´ë©´ ë¬´ì¡°ê±´ ë§¤ì¹­ (ê¸¸ì´ ë¬´ê´€)
 * ì˜ˆ: "ã…‹ã…‹", "ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹", "ã…ã…ã…ã…ã…" ëª¨ë‘ ë§¤ì¹­
 */
const smallTalkPatterns = [
  // ì›ƒìŒ (ã…‹/ã…ë§Œ 2ê°œ ì´ìƒì´ë©´ ë¬´ì¡°ê±´ ì¡ë‹´)
  { pattern: /^[ã…‹ã…]{2,}$/i, responses: [
    "ã…‹ã…‹ ì™œ ì›ƒì–´? ğŸ˜„",
    "ë­ê°€ ê·¸ë ‡ê²Œ ì›ƒê²¨? ã…‹ã…‹",
    "ã…ã… ê¸°ë¶„ ì¢‹ì€ê°€ë´! âœ¨"
  ]},
  
  // ì¸ì‚¬ (ë‹¨ì–´ í¬í•¨ ì‹œ ë§¤ì¹­)
  { pattern: /ì•ˆë…•|í•˜ì´|í—¬ë¡œ|hi|hello|yo/i, responses: [
    "ì•ˆë…•! ì˜¤ëŠ˜ ì–´ë–¤ ì˜í™” ì°¾ì•„ì¤„ê¹Œ? ğŸ˜Š",
    "í•˜ì´~ ê¸°ë¶„ì€ ì–´ë•Œ?",
    "ë°˜ê°€ì›Œ! âœ¨ ì˜¤ëŠ˜ ë­ ë³¼ê¹Œ?"
  ]},
  
  // ê°ì‚¬
  { pattern: /ê³ ë§ˆì›Œ|ê°ì‚¬|ë•¡í|thx|thanks/i, responses: [
    "ì²œë§Œì—! ë‹¤ë¥¸ ì˜í™” í•„ìš”í•˜ë©´ ë§í•´ ğŸ˜Š",
    "ë³„ë§ì”€ì„~ ë˜ ì°¾ì•„ì¤„ê²Œ!",
    "ã…ã… ë„ì›€ì´ ëë‹¤ë‹ˆ ë‹¤í–‰ì´ì•¼! âœ¨"
  ]},
  
  // ê°ì • í‘œí˜„ (ë¶€ì •)
  { pattern: /í˜ë“¤ì–´|ìš°ìš¸í•´|ìŠ¬í¼|ì§€ì³|í”¼ê³¤í•´/i, responses: [
    "í˜ë“  ë‚ ì—” ì—­ì‹œ ì›ƒê¸´ ì˜í™”ê°€ ìµœê³ ì§€! ì½”ë¯¸ë”” ì¶”ì²œí•´ì¤„ê¹Œ? ğŸ˜Š",
    "ê·¸ëŸ´ ë• ê°ë™ì ì¸ ì˜í™” ì–´ë•Œ? ìœ„ë¡œë°›ì„ ìˆ˜ ìˆì–´ ğŸ¤—",
    "ìš°ìš¸í•  ë• ê°€ë³ê²Œ ë³¼ ìˆ˜ ìˆëŠ” ê±° ì°¾ì•„ì¤„ê²Œ!"
  ]},
  
  // ê°ì • í‘œí˜„ (ê¸ì •)
  { pattern: /ê¸°ë¶„\s?ì¢‹ì•„|í–‰ë³µí•´|ìµœê³ |êµ¿|ì¢‹ë„¤/i, responses: [
    "ê¸°ë¶„ ì¢‹ì€ ë‚ ì—” ì‹ ë‚˜ëŠ” ì˜í™” ì–´ë•Œ? ğŸ‰",
    "ì¢‹ë‹¤ë‹ˆ ë‚˜ë„ ê¸°ë¶„ ì¢‹ì•„! ë­ ë³¼ê¹Œ? âœ¨",
    "ì™„ì „ ì¢‹ì€ ë‚ ì´ë„¤! ì˜¤ëŠ˜ì€ ë­ ë³¼ë˜?"
  ]},
  
  // ì§§ì€ ë°˜ì‘ (1~2ê¸€ì + ê³µë°±ë§Œ)
  { pattern: /^[ì˜¤ì–´ìŒí ì•„ê·¸ë˜ã…‡ã…‹ok\s]+$/i, responses: [
    "ê·¸ë˜ì„œ, ë­ ë³¼ê¹Œ? ğŸ¬",
    "ì˜í™” ì¶”ì²œ í•„ìš”í•´? ğŸ˜Š",
    "ì˜¤ëŠ˜ ê¸°ë¶„ì€ ì–´ë•Œ?"
  ]},
  
  // ìš•ì„¤/ë¶€ì •ì  (ì¹œê·¼í•˜ê²Œ ì „í™˜)
  { pattern: /ì‹œë°œ|ã……ã…‚|ì”¨ë°œ|fuck|shit/i, responses: [
    "ì–´ì–´ í™”ë‚¬êµ¬ë‚˜! ì† ì‹œì›í•œ ì•¡ì…˜ ì˜í™” ì–´ë•Œ? ğŸ˜¤",
    "ìŠ¤íŠ¸ë ˆìŠ¤ í’€ë¦´ë§Œí•œ ê±° ì°¾ì•„ì¤„ê²Œ!",
    "í™”ë‚˜ë©´ ìš•í•´ë„ ê´œì°®ì•„ ã…‹ã…‹ ë­ ë³¼ê¹Œ?"
  ]},
];

/**
 * Cheap Brain ë©”ì¸ ë¡œì§
 */
export function getCheapResponse(message: string, persona: string): CheapResponse | null {
  const trimmedMessage = message.trim();
  
  // [v5.11 í•µì‹¬ ìˆ˜ì •] "ì¶”ì²œ"ì´ë¼ëŠ” ë‹¨ì–´ê°€ ìˆìœ¼ë©´ Cheap Brainì€ ë¬´ì‹œí•˜ê³ 
  // ë’¤ì— ìˆëŠ” Smart Brain/Intent Cacheì—ê²Œ ë„˜ê¸´ë‹¤! (ê·¸ë˜ì•¼ ì˜í™”ê°€ ë‚˜ì˜´)
  if (trimmedMessage.includes("ì¶”ì²œ") || trimmedMessage.includes("ë³´ì—¬ì¤˜")) {
    return null;
  }
  
  // ë„ˆë¬´ ê¸´ ë©”ì‹œì§€ëŠ” Smart Brainìœ¼ë¡œ
  if (trimmedMessage.length > 30) {
    return null;
  }
  
  // íŒ¨í„´ ë§¤ì¹­
  for (const { pattern, responses } of smallTalkPatterns) {
    if (pattern.test(trimmedMessage)) {
      // ëœë¤ ì‘ë‹µ ì„ íƒ
      const randomResponse = responses[Math.floor(Math.random() * responses.length)];
      
      // í˜ë¥´ì†Œë‚˜ ì ìš©
      let text = randomResponse;
      if (persona === 'ì¸¤ë°ë ˆ ì¹œêµ¬') {
        // ì¸¤ë°ë ˆ ë²„ì „ìœ¼ë¡œ ë³€í™˜
        text = text
          .replace('ğŸ˜Š', '')
          .replace('âœ¨', '')
          .replace('ğŸ¤—', '')
          .replace('ì²œë§Œì—', 'ë­ ë³„ê±° ì•„ë‹Œë°')
          .replace('ê¸°ë¶„ ì¢‹ì•„', 'ë­... ë‚˜ì˜ì§€ ì•Šë„¤')
          .replace('ë°˜ê°€ì›Œ', 'ì–´... ì™”ì–´?');
      }
      
      console.log(`ğŸ’° [Cheap Brain] ë¹„ìš© $0 | íŒ¨í„´: ${pattern.source} | ì…ë ¥: "${trimmedMessage}"`);
      
      return {
        type: 'reply',
        text,
        keywords: []
      };
    }
  }
  
  // ë§¤ì¹­ ì‹¤íŒ¨ â†’ Smart Brainìœ¼ë¡œ
  return null;
}